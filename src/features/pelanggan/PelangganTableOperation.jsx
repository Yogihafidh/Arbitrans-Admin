import { useRef, useState } from "react";
import { useNavigate } from "react-router";
import { useClickOutside } from "../../hooks/useClikOutside";
import Button from "../../ui/Button";
import InputSearch from "../../ui/InputSearch";
import Modal from "../../ui/Modal";
import PelangganForm from "./PelangganForm";
import ButtonIcon from "../../ui/ButtonIcon";

function PelangganTableOperation() {
  const navigate = useNavigate();
  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);

  const containerRef = useRef(null);
  useClickOutside(
    containerRef,
    () => setIsMobileMenuOpen(false),
    isMobileMenuOpen,
  );

  return (
    <div className="relative flex flex-col gap-4">
      <div className="flex flex-shrink items-center justify-between gap-2 sm:flex-shrink-0">
        <div className="min-w-0 flex-grow sm:min-w-fit sm:flex-grow-0">
          <InputSearch
            placeholder="Cari pelanggan..."
            icon={
              <svg
                width="16"
                height="16"
                viewBox="0 0 14 14"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M13.3536 12.6464L10.2243 9.51764C11.1313 8.42871 11.5836 7.03201 11.487 5.6181C11.3905 4.20419 10.7526 2.88193 9.70599 1.92637C8.65938 0.970822 7.28468 0.455551 5.86784 0.487751C4.451 0.519951 3.10112 1.09714 2.09901 2.09926C1.0969 3.10137 0.519707 4.45125 0.487507 5.86808C0.455307 7.28492 0.970578 8.65963 1.92613 9.70623C2.88168 10.7528 4.20395 11.3908 5.61786 11.4873C7.03177 11.5838 8.42846 11.1315 9.5174 10.2245L12.6461 13.3539C12.6926 13.4003 12.7478 13.4372 12.8085 13.4623C12.8691 13.4875 12.9342 13.5004 12.9999 13.5004C13.0656 13.5004 13.1307 13.4875 13.1913 13.4623C13.252 13.4372 13.3072 13.4003 13.3536 13.3539C13.4001 13.3074 13.437 13.2523 13.4621 13.1916C13.4872 13.1309 13.5002 13.0658 13.5002 13.0001C13.5002 12.9344 13.4872 12.8694 13.4621 12.8087C13.437 12.748 13.4001 12.6928 13.3536 12.6464ZM1.4999 6.00014C1.4999 5.11013 1.76382 4.2401 2.25829 3.50008C2.75275 2.76006 3.45556 2.18328 4.27782 1.84268C5.10009 1.50209 6.00489 1.41298 6.8778 1.58661C7.75072 1.76024 8.55254 2.18883 9.18188 2.81816C9.81122 3.4475 10.2398 4.24932 10.4134 5.12224C10.5871 5.99515 10.498 6.89995 10.1574 7.72222C9.81676 8.54449 9.23999 9.24729 8.49996 9.74176C7.75994 10.2362 6.88991 10.5001 5.9999 10.5001C4.80683 10.4988 3.66301 10.0243 2.81938 9.18066C1.97575 8.33704 1.50122 7.19321 1.4999 6.00014Z"
                  fill="currentColor"
                />
              </svg>
            }
          />
        </div>

        <div className="md:hidden">
          <ButtonIcon
            icon={
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  fill-rule="evenodd"
                  clip-rule="evenodd"
                  d="M4.96134 2.00065H19.1413V2.01065C20.3363 1.98986 21.4217 2.70428 21.875 3.81009C22.3284 4.9159 22.057 6.1866 21.1913 7.01065L16.4213 11.7807C15.8904 12.3125 15.5858 13.0292 15.5713 13.7807V18.1807C15.5698 19.0931 15.1403 19.9519 14.4113 20.5007L13.1713 21.4307C12.2944 22.0979 11.1144 22.2085 10.1288 21.7157C9.14325 21.2229 8.52367 20.2125 8.53134 19.1107V13.7807C8.51691 13.0292 8.21231 12.3125 7.68134 11.7807L2.91134 7.01065C2.0381 6.18783 1.76172 4.91222 2.2161 3.80176C2.67049 2.6913 3.76178 1.97531 4.96134 2.00065ZM20.4413 4.37065C20.2255 3.84303 19.7114 3.49894 19.1413 3.50065H4.96134C4.3913 3.49894 3.87714 3.84303 3.66134 4.37065C3.43857 4.89571 3.56176 5.50372 3.97134 5.90065L8.76134 10.6707C9.59042 11.4928 10.0551 12.6131 10.0513 13.7807V19.1107C10.046 19.4793 10.1873 19.835 10.4443 20.0994C10.7012 20.3639 11.0527 20.5154 11.4213 20.5207C11.7226 20.5193 12.0148 20.4172 12.2513 20.2307L13.4913 19.3007C13.8439 19.0363 14.0513 18.6213 14.0513 18.1807V13.7807C14.0529 12.6102 14.5249 11.4895 15.3613 10.6707L20.1313 5.90065C20.5409 5.50372 20.6641 4.89571 20.4413 4.37065Z"
                  fill="#212529"
                />
              </svg>
            }
            text="Menu"
            type="primary"
            onEvent={() => setIsMobileMenuOpen((prev) => !prev)}
            className="p-2"
          />
        </div>

        <div className="hidden items-center justify-between gap-4 md:flex">
          <Button
            onClick={() => navigate("/pelanggan/riwayat")}
            type="third"
            text="Riwayat"
            leftIcon={
              <svg
                width="25"
                height="24"
                viewBox="0 0 17 16"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M9 5.00002V7.71689L11.2575 9.07127C11.3712 9.13956 11.4531 9.25023 11.4853 9.37893C11.5174 9.50762 11.497 9.64381 11.4287 9.75752C11.3605 9.87123 11.2498 9.95316 11.1211 9.98527C10.9924 10.0174 10.8562 9.99706 10.7425 9.92877L8.2425 8.42877C8.16851 8.38432 8.10728 8.32146 8.06479 8.24633C8.02229 8.17119 7.99997 8.08634 8 8.00002V5.00002C8 4.86741 8.05268 4.74023 8.14645 4.64647C8.24021 4.5527 8.36739 4.50002 8.5 4.50002C8.63261 4.50002 8.75979 4.5527 8.85355 4.64647C8.94732 4.74023 9 4.86741 9 5.00002ZM8.5 2.00002C7.71125 1.99805 6.92994 2.15254 6.20128 2.45454C5.47263 2.75653 4.81111 3.20004 4.255 3.75939C3.80062 4.21939 3.39687 4.66189 3 5.12502V4.00002C3 3.86741 2.94732 3.74023 2.85355 3.64647C2.75979 3.5527 2.63261 3.50002 2.5 3.50002C2.36739 3.50002 2.24021 3.5527 2.14645 3.64647C2.05268 3.74023 2 3.86741 2 4.00002V6.50002C2 6.63263 2.05268 6.7598 2.14645 6.85357C2.24021 6.94734 2.36739 7.00002 2.5 7.00002H5C5.13261 7.00002 5.25978 6.94734 5.35355 6.85357C5.44732 6.7598 5.5 6.63263 5.5 6.50002C5.5 6.36741 5.44732 6.24023 5.35355 6.14647C5.25978 6.0527 5.13261 6.00002 5 6.00002H3.5625C4.00937 5.47377 4.45437 4.97814 4.96187 4.46439C5.65678 3.76949 6.54107 3.29477 7.50423 3.09957C8.46739 2.90436 9.46673 2.99732 10.3774 3.36682C11.288 3.73633 12.0696 4.366 12.6244 5.17715C13.1792 5.9883 13.4827 6.94497 13.4969 7.92761C13.5111 8.91026 13.2354 9.8753 12.7043 10.7022C12.1732 11.529 11.4102 12.181 10.5106 12.5767C9.61103 12.9724 8.6148 13.0942 7.6464 12.927C6.67799 12.7597 5.78034 12.3108 5.06562 11.6363C5.01786 11.5911 4.96166 11.5558 4.90026 11.5324C4.83885 11.509 4.77343 11.4979 4.70773 11.4997C4.64204 11.5016 4.57735 11.5164 4.51736 11.5432C4.45738 11.5701 4.40327 11.6085 4.35812 11.6563C4.31298 11.704 4.27769 11.7602 4.25427 11.8216C4.23084 11.883 4.21974 11.9485 4.2216 12.0142C4.22345 12.0799 4.23823 12.1445 4.26509 12.2045C4.29195 12.2645 4.33036 12.3186 4.37812 12.3638C5.09028 13.0358 5.95609 13.5234 6.9 13.7838C7.84391 14.0443 8.83722 14.0698 9.79326 13.8581C10.7493 13.6464 11.639 13.204 12.3847 12.5694C13.1304 11.9347 13.7095 11.1273 14.0713 10.2174C14.4332 9.30753 14.5669 8.32293 14.4607 7.34951C14.3546 6.37609 14.0118 5.44345 13.4623 4.63298C12.9128 3.8225 12.1733 3.15883 11.3083 2.69988C10.4433 2.24093 9.47919 2.00066 8.5 2.00002Z"
                  fill="currentColor"
                />
              </svg>
            }
          />
          <Modal>
            <Modal.Open opens="pelanggan-form">
              <Button
                text="Tambah Pelanggan"
                type="primary"
                leftIcon={
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M19.75 11H12.5V3.75C12.5 3.33579 12.1642 3 11.75 3C11.3358 3 11 3.33579 11 3.75V11H3.75C3.33579 11 3 11.3358 3 11.75C3 12.1642 3.33579 12.5 3.75 12.5H11V19.75C11 20.1642 11.3358 20.5 11.75 20.5C12.1642 20.5 12.5 20.1642 12.5 19.75V12.5H19.75C20.1642 12.5 20.5 12.1642 20.5 11.75C20.5 11.3358 20.1642 11 19.75 11Z"
                      fill="currentColor"
                    />
                  </svg>
                }
              />
            </Modal.Open>
            <Modal.Window name="pelanggan-form">
              <PelangganForm />
            </Modal.Window>
          </Modal>
        </div>
      </div>

      {isMobileMenuOpen && (
        <div
          ref={containerRef}
          className="absolute top-10 right-0 z-30 flex flex-col gap-4 rounded-md border-white bg-white/20 p-4 shadow-md backdrop-blur-sm md:hidden"
        >
          <div className="flex flex-col items-center justify-between gap-4 sm:flex-row">
            <Modal>
              <Modal.Open opens="pelanggan-form">
                <Button
                  text="Tambah Pelanggan"
                  type="primary"
                  leftIcon={
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      xmlns="http://www.w3.org/2000/svg"
                    >
                      <path
                        d="M19.75 11H12.5V3.75C12.5 3.33579 12.1642 3 11.75 3C11.3358 3 11 3.33579 11 3.75V11H3.75C3.33579 11 3 11.3358 3 11.75C3 12.1642 3.33579 12.5 3.75 12.5H11V19.75C11 20.1642 11.3358 20.5 11.75 20.5C12.1642 20.5 12.5 20.1642 12.5 19.75V12.5H19.75C20.1642 12.5 20.5 12.1642 20.5 11.75C20.5 11.3358 20.1642 11 19.75 11Z"
                        fill="currentColor"
                      />
                    </svg>
                  }
                  className="w-full"
                />
              </Modal.Open>
              <Modal.Window name="pelanggan-form">
                <PelangganForm />
              </Modal.Window>
            </Modal>

            <Button
              onClick={() => navigate("/pelanggan/riwayat")}
              type="third"
              text="Riwayat"
              leftIcon={
                <svg
                  width="25"
                  height="24"
                  viewBox="0 0 17 16"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9 5.00002V7.71689L11.2575 9.07127C11.3712 9.13956 11.4531 9.25023 11.4853 9.37893C11.5174 9.50762 11.497 9.64381 11.4287 9.75752C11.3605 9.87123 11.2498 9.95316 11.1211 9.98527C10.9924 10.0174 10.8562 9.99706 10.7425 9.92877L8.2425 8.42877C8.16851 8.38432 8.10728 8.32146 8.06479 8.24633C8.02229 8.17119 7.99997 8.08634 8 8.00002V5.00002C8 4.86741 8.05268 4.74023 8.14645 4.64647C8.24021 4.5527 8.36739 4.50002 8.5 4.50002C8.63261 4.50002 8.75979 4.5527 8.85355 4.64647C8.94732 4.74023 9 4.86741 9 5.00002ZM8.5 2.00002C7.71125 1.99805 6.92994 2.15254 6.20128 2.45454C5.47263 2.75653 4.81111 3.20004 4.255 3.75939C3.80062 4.21939 3.39687 4.66189 3 5.12502V4.00002C3 3.86741 2.94732 3.74023 2.85355 3.64647C2.75979 3.5527 2.63261 3.50002 2.5 3.50002C2.36739 3.50002 2.24021 3.5527 2.14645 3.64647C2.05268 3.74023 2 3.86741 2 4.00002V6.50002C2 6.63263 2.05268 6.7598 2.14645 6.85357C2.24021 6.94734 2.36739 7.00002 2.5 7.00002H5C5.13261 7.00002 5.25978 6.94734 5.35355 6.85357C5.44732 6.7598 5.5 6.63263 5.5 6.50002C5.5 6.36741 5.44732 6.24023 5.35355 6.14647C5.25978 6.0527 5.13261 6.00002 5 6.00002H3.5625C4.00937 5.47377 4.45437 4.97814 4.96187 4.46439C5.65678 3.76949 6.54107 3.29477 7.50423 3.09957C8.46739 2.90436 9.46673 2.99732 10.3774 3.36682C11.288 3.73633 12.0696 4.366 12.6244 5.17715C13.1792 5.9883 13.4827 6.94497 13.4969 7.92761C13.5111 8.91026 13.2354 9.8753 12.7043 10.7022C12.1732 11.529 11.4102 12.181 10.5106 12.5767C9.61103 12.9724 8.6148 13.0942 7.6464 12.927C6.67799 12.7597 5.78034 12.3108 5.06562 11.6363C5.01786 11.5911 4.96166 11.5558 4.90026 11.5324C4.83885 11.509 4.77343 11.4979 4.70773 11.4997C4.64204 11.5016 4.57735 11.5164 4.51736 11.5432C4.45738 11.5701 4.40327 11.6085 4.35812 11.6563C4.31298 11.704 4.27769 11.7602 4.25427 11.8216C4.23084 11.883 4.21974 11.9485 4.2216 12.0142C4.22345 12.0799 4.23823 12.1445 4.26509 12.2045C4.29195 12.2645 4.33036 12.3186 4.37812 12.3638C5.09028 13.0358 5.95609 13.5234 6.9 13.7838C7.84391 14.0443 8.83722 14.0698 9.79326 13.8581C10.7493 13.6464 11.639 13.204 12.3847 12.5694C13.1304 11.9347 13.7095 11.1273 14.0713 10.2174C14.4332 9.30753 14.5669 8.32293 14.4607 7.34951C14.3546 6.37609 14.0118 5.44345 13.4623 4.63298C12.9128 3.8225 12.1733 3.15883 11.3083 2.69988C10.4433 2.24093 9.47919 2.00066 8.5 2.00002Z"
                    fill="currentColor"
                  />
                </svg>
              }
              className="w-full sm:w-fit"
            />
          </div>
        </div>
      )}
    </div>
  );
}

export default PelangganTableOperation;
